google.load("visualization","1",{packages:["corechart"]});
function fetch_data_and_show_chart(f){dojo.byId("messageArea").style.display="none";dojo.byId("days").value=f;for(var d=dijit.byId("history_type").get("value"),b=1;5>b;b++)dojo.byId("HistoryResultsHideMe"+b).style.display="none",dojo.byId("HistoryResults"+b).innerHTML="";var g=[],c=[];switch(d){case "points":g.push(TEXT_ALLYHISTORY_SCORE);c.push("points");break;case "epoints":g.push(TEXT_ALLYHISTORY_ESCORE);c.push("epoints");break;case "fpoints":g.push(TEXT_ALLYHISTORY_MSCORE);c.push("fpoints");break;
case "rpoints":g.push(TEXT_ALLYHISTORY_RSCORE);c.push("rpoints");break;case "all":g.push(TEXT_ALLYHISTORY_SCORE),c.push("points"),g.push(TEXT_ALLYHISTORY_ESCORE),c.push("epoints"),g.push(TEXT_ALLYHISTORY_MSCORE),c.push("fpoints"),g.push(TEXT_ALLYHISTORY_RSCORE),c.push("rpoints")}for(var h=[],k=[],b=1;6>b;b++)d=dijit.byId("alliance_"+b).get("value"),0<d.length&&k.push(d),d=dijit.byId("player_"+b).get("value"),0<d.length&&h.push(d);if(!(1>h.length+k.length)){for(b=0;b<g.length;b++)dojo.byId("HistoryResults"+
(b+1)).innerHTML=TEXT_ALLYHISTORY_TBLHEAD+": "+g[b],dojo.byId("HistoryResultsHideMe"+(b+1)).style.display="block",dojo.byId("chart_div"+(b+1)).innerHTML='<div id="loadingAreaContent"  style="width: 100%; height: 100px;"><img src="../images/loader_big_ogame_bg.gif" style="display:block; margin: 30px auto;" /></div>',d={url:"ajax/ajax_history.php?type="+c[b]+"&chart=chart_div"+(b+1),handleAs:"json",content:{player_data:h.join("|"),ally_data:k.join("|"),timespan:f},load:function(a){null!=a.messages&&
showMessages(a.messages);0<a.data.length?galaxytool_drawHistoryChart(a.data,h,k,a.chart):(dojo.byId("chart_div1").innerHTML="",dojo.byId("chart_div2").innerHTML="",dojo.byId("chart_div3").innerHTML="",dojo.byId("chart_div4").innerHTML="")},error:function(a){console.log("Error:");console.log(a)}},dojo.xhrPost(d);return!1}}
function galaxytool_drawHistoryChart(f,d,b,g){var c=new google.visualization.DataTable;c.addColumn("date",TEXT_REPORTS_DATE);for(var h=0,k=[],a=0;a<d.length;a++)h++,c.addColumn("number",playerStore._itemsByIdentity[d[a]].player.toString()),k[d[a]]=h;d=[];for(a=0;a<b.length;a++)h++,c.addColumn("number",allyStore._itemsByIdentity[b[a]].allyname.toString()),d[b[a]]=h;b=[];for(a=0;a<f.length;a++){var l=Array(h+1),e=f[a][0].split("-");l[0]=3==e.length?new Date(e[0],e[1]-1,e[2]):new Date(e[0],e[1]-1);for(e=
0;e<f[a][1].length;e++)l[k[f[a][1][e][0]]]=f[a][1][e][1];for(e=0;e<f[a][2].length;e++)l[d[f[a][2][e][0]]]=f[a][2][e][1];b.push(l)}c.addRows(b);(new google.visualization.DateFormat({pattern:"yyyy-MM-dd"})).format(c,0);f=new google.visualization.NumberFormat({decimalSymbol:",",groupingSymbol:".",fractionDigits:0});for(a=1;a<=h;a++)f.format(c,a);(new google.visualization.LineChart(document.getElementById(g))).draw(c,{backgroundColor:"#13181D",vAxis:{textStyle:{color:"#C4C4C4"}},hAxis:{textStyle:{color:"#C4C4C4"},
gridlines:{color:"#13181D"}},legend:{textStyle:{color:"#C4C4C4"}},interpolateNulls:!0,pointSize:5})}function galaxytool_history_init(){playerStore.fetch();allyStore.fetch()}dojo.ready(galaxytool_history_init);
